{% extends 'base.html.twig' %}

{% block title %}Accueil{% endblock %}

{% block body %}
    <!-- En-tête de bienvenue -->
    <div class="card mb-3">
        <div class="card-header bg-subtle-primary">
            <h5 class="mb-0">Tableau de bord</h5>
        </div>
        <div class="card-body">
            {% if app.user %}
                <h4 class="mb-1">Bonjour, <strong>{{ app.user.userIdentifier }}</strong> !</h4>
                <p class="text-muted mb-0">
                    {% if is_granted('ROLE_ADMIN') %}
                        Voici l'état actuel de votre parc immobilier.
                    {% else %}
                        Bienvenue dans votre espace locataire BailManager.
                    {% endif %}
                </p>
            {% else %}
                <p>Bienvenue sur notre application.</p>
            {% endif %}
        </div>
    </div>

    {% if is_granted('ROLE_ADMIN') %}
        <!-- STATS POUR ADMINISTRATEUR -->
        <div class="row g-3 mb-3">
            <div class="col-sm-6 col-md-3">
                <div class="card overflow-hidden" style="min-height: 12rem">
                    <div class="bg-holder bg-card" style="background-image:url(assets/img/icons/spot-illustrations/corner-1.png);"></div>
                    <div class="card-body position-relative">
                        <h6>Total Biens</h6>
                        <div class="display-4 fs-5 mb-2 fw-normal font-sans-serif text-primary" data-countup='{"endValue":24}'>24</div>
                        <div class="d-flex align-items-center">
                            <span class="badge badge-subtle-success rounded-pill fs-11">+2</span>
                            <span class="fs-11 ms-1">ce mois</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-md-3">
                <div class="card overflow-hidden" style="min-height: 12rem">
                    <div class="bg-holder bg-card" style="background-image:url(assets/img/icons/spot-illustrations/corner-2.png);"></div>
                    <div class="card-body position-relative">
                        <h6>Locataires Actifs</h6>
                        <div class="display-4 fs-5 mb-2 fw-normal font-sans-serif text-success" data-countup='{"endValue":22}'>22</div>
                        <div class="d-flex align-items-center">
                            <span class="badge badge-subtle-success rounded-pill fs-11">91.7%</span>
                            <span class="fs-11 ms-1">occupé</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-md-3">
                <div class="card overflow-hidden" style="min-height: 12rem">
                    <div class="bg-holder bg-card" style="background-image:url(assets/img/icons/spot-illustrations/corner-3.png);"></div>
                    <div class="card-body position-relative">
                        <h6>Revenus Mensuel</h6>
                        <div class="display-4 fs-5 mb-2 fw-normal font-sans-serif text-info">€18,500</div>
                        <div class="d-flex align-items-center">
                            <span class="badge badge-subtle-success rounded-pill fs-11">+5.2%</span>
                            <span class="fs-11 ms-1">vs mois dernier</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-md-3">
                <div class="card overflow-hidden" style="min-height: 12rem">
                    <div class="bg-holder bg-card" style="background-image:url(assets/img/icons/spot-illustrations/corner-4.png);"></div>
                    <div class="card-body position-relative">
                        <h6>Impayés</h6>
                        <div class="display-4 fs-5 mb-2 fw-normal font-sans-serif text-warning">€1,200</div>
                        <div class="d-flex align-items-center">
                            <span class="badge badge-subtle-warning rounded-pill fs-11">2</span>
                            <span class="fs-11 ms-1">locataires</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-3 mb-3">
            <div class="col-lg-8">
                <div class="card h-100">
                    <div class="card-header border-bottom">
                        <div class="row flex-between-end">
                            <div class="col-auto align-self-center">
                                <h6 class="mb-0">Notifications Récentes</h6>
                            </div>
                            <div class="col-auto ms-auto">
                                <button class="btn btn-link btn-sm p-0 fs-11" type="button">Voir tout</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="timeline-simple">
                            <div class="timeline-item">
                                <div class="timeline-icon"><span class="fas fa-exclamation-triangle text-warning"></span></div>
                                <div class="timeline-content">
                                    <p class="fs-11 mb-1"><strong>Loyer en retard</strong> - Appartement 15 Rue Victor Hugo</p>
                                    <p class="fs-11 text-muted mb-0">Il y a 2 jours</p>
                                </div>
                            </div>
                            <!-- ... autres items admin ... -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">Actions Rapides</h6>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a class="btn btn-primary btn-sm" href="{{ path('app_contrat_new') }}">
                                <span class="fas fa-plus me-1"></span>Nouveau Contrat
                            </a>
                            <a class="btn btn-success btn-sm" href="#">
                                <span class="fas fa-money-bill-wave me-1"></span>Encaisser Loyer
                            </a>
                            <a class="btn btn-info btn-sm" href="{{ path('app_biens_new') }}">
                                <span class="fas fa-building me-1"></span>Ajouter un Bien
                            </a>
                            <a class="btn btn-secondary btn-sm" href="{{ path('app_locataire_new') }}">
                                <span class="fas fa-user-plus me-1"></span>Ajouter Locataire
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <!-- STATS POUR LOCATAIRE -->
        <div class="row g-3 mb-3">
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="avatar avatar-3xl mb-3">
                            <div class="avatar-name rounded-circle bg-subtle-primary text-primary fs-3">
                                <span class="fas fa-file-contract"></span>
                            </div>
                        </div>
                        <h5>Mon Contrat</h5>
                        <p class="fs-11 text-muted">Consultez les détails de votre bail actuel.</p>
                        {% if app.user and app.user.locataire and app.user.locataire.contrats|length > 0 %}
                            <a class="btn btn-outline-primary btn-sm" href="{{ path('app_contrat_show', {'id': app.user.locataire.contrats.first.id}) }}">Voir mon contrat</a>
                        {% else %}
                            <span class="badge badge-subtle-warning">Aucun contrat actif</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="avatar avatar-3xl mb-3">
                            <div class="avatar-name rounded-circle bg-subtle-success text-success fs-3">
                                <span class="fas fa-receipt"></span>
                            </div>
                        </div>
                        <h5>Mes Quittances</h5>
                        <p class="fs-11 text-muted">Téléchargez vos dernières quittances de loyer.</p>
                        <a class="btn btn-outline-success btn-sm" href="#">Accéder aux documents</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="avatar avatar-3xl mb-3">
                            <div class="avatar-name rounded-circle bg-subtle-warning text-warning fs-3">
                                <span class="fas fa-tools"></span>
                            </div>
                        </div>
                        <h5>Maintenance</h5>
                        <p class="fs-11 text-muted">Un problème ? Signalez une intervention.</p>
                        <a class="btn btn-outline-warning btn-sm" href="#">Signaler un problème</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-3">
            <div class="col-lg-12">
                <div class="card bg-dark text-white overflow-hidden">
                    <div class="card-body d-flex align-items-center">
                        <div class="flex-1">
                            <h3>Découvrez d'autres biens !</h3>
                            <p class="mb-0 opacity-75">Nous avons de nouvelles opportunités pour vous ou vos proches.</p>
                            <a class="btn btn-link text-white ps-0 mt-2" href="{{ path('app_biens_index') }}">
                                Voir le catalogue <span class="fas fa-chevron-right ms-1 fs-11"></span>
                            </a>
                        </div>
                        <div class="ms-3 d-none d-md-block">
                            <span class="fas fa-search-location fa-5x opacity-25"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

{% endblock %}
