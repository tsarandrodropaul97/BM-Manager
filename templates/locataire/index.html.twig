{% extends 'base.html.twig' %}

{% block title %}Gestion des Locataires
{% endblock %}

{% block body %}
<!-- En-tête page -->
<div class="card mb-3">
	<div class="card-header border-bottom">
		<div class="row flex-between-center g-3">
			<div class="col-12 col-sm-auto align-self-center">
				<h5 class="mb-0">Gestion des Locataires</h5>
				<p class="mb-0 fs-11 text-muted">Aperçu et gestion de vos locataires à Madagascar</p>
			</div>
			<div class="col-12 col-sm-auto ms-auto">
				<div class="d-flex gap-2">
					<a href="{{ path('app_locataire_new') }}" class="btn btn-primary btn-sm">
						<span class="fas fa-plus me-1"></span>Ajouter un locataire
					</a>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Filtres -->
<div class="card mb-3">
	<div class="card-body">
		<form method="get" action="{{ path('app_locataire_index') }}" class="row g-3 align-items-center">
			<div class="col-12 col-md-3">
				<div class="input-group">
					<span class="input-group-text bg-200 border-end-0">
						<span class="fas fa-search text-600"></span>
					</span>
					<input type="text" name="search" value="{{ filters.search }}"
						class="form-control border-start-0 ps-0" placeholder="Nom, prénom, email...">
				</div>
			</div>
			<div class="col-12 col-sm-4 col-md-2">
				<select name="statut" class="form-select">
					<option value="">Tous les statuts</option>
					<option value="actif" {{ filters.statut=='actif' ? 'selected' : '' }}>Actif</option>
					<option value="inactif" {{ filters.statut=='inactif' ? 'selected' : '' }}>Inactif</option>
					<option value="en_attente" {{ filters.statut=='en_attente' ? 'selected' : '' }}>En attente</option>
					<option value="preavis" {{ filters.statut=='preavis' ? 'selected' : '' }}>Préavis</option>
				</select>
			</div>
			<div class="col-12 col-sm-4 col-md-2">
				<input type="text" name="ville" value="{{ filters.ville }}" class="form-control"
					placeholder="Ville du bien">
			</div>
			<div class="col-12 col-sm-4 col-md-2">
				<input type="date" name="dateEntree" value="{{ filters.dateEntree }}" class="form-control"
					title="Date d'entrée">
			</div>
			<div class="col-12 col-md-auto ms-auto text-center text-md-end">
				<button type="submit" class="btn btn-primary px-4">Filtrer</button>
				<a href="{{ path('app_locataire_index') }}"
					class="btn btn-link py-0 text-muted fs-11 mt-2 mt-md-0 d-block d-md-inline-block">Réinitialiser</a>
			</div>
		</form>
	</div>
</div>

<!-- Liste des locataires -->
<div class="card mb-3">
	<div class="card-header border-bottom">
		<h6 class="mb-0">Liste des Locataires ({{ pagination.getTotalItemCount }})</h6>
	</div>
	<div class="card-body p-0">
		<!-- Mode liste (Table) -->
		<div class="table-responsive scrollbar">
			<table class="table table-sm table-striped fs-11 mb-0">
				<thead class="bg-200 text-900">
					<tr>
						<th class="align-middle ps-3">Locataire</th>
						<th class="align-middle">Téléphone</th>
						<th class="align-middle">Email</th>
						<th class="align-middle">Bien Loué</th>
						<th class="align-middle">Statut</th>
						<th class="align-middle text-center">Entrée</th>
						<th class="align-middle text-end pe-3">Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for locataire in pagination %}
					<tr>
						<td class="align-middle ps-3">
							<div class="d-flex align-items-center">
								<div class="avatar avatar-l me-2">
									{% if locataire.photo %}
									<img src="{{ asset('uploads/locataires/' ~ locataire.photo) }}" alt=""
										class="rounded-circle" style="width: 40px; height: 40px; object-fit: cover;">
									{% else %}
									<div class="bg-subtle-primary text-primary d-flex align-items-center justify-content-center rounded-circle"
										style="width: 40px; height: 40px;">
										<span class="fas fa-user fs-11"></span>
									</div>
									{% endif %}
								</div>
								<div>
									<h6 class="mb-0 text-nowrap">{{ locataire.nomComplet }}</h6>
									<p class="mb-0 fs-11 text-muted text-nowrap">{{ locataire.profession }}</p>
								</div>
							</div>
						</td>
						<td class="align-middle">{{ locataire.telephone }}</td>
						<td class="align-middle">{{ locataire.email }}</td>
						<td class="align-middle">
							{% if locataire.bien %}
							<a href="{{ path('app_biens_show', {'id': locataire.bien.id}) }}"
								class="text-primary fw-semi-bold">
								{{ locataire.bien.designation }}
							</a>
							<div class="fs-11 text-muted">{{ locataire.bien.ville }}</div>
							{% else %}
							<span class="text-muted">Aucun bien</span>
							{% endif %}
						</td>
						<td class="align-middle">
							{% if locataire.statut == 'actif' %}
							<span class="badge badge-subtle-success">Actif</span>
							{% elseif locataire.statut == 'inactif' %}
							<span class="badge badge-subtle-danger">Inactif</span>
							{% elseif locataire.statut == 'preavis' %}
							<span class="badge badge-subtle-warning">Préavis</span>
							{% else %}
							<span class="badge badge-subtle-info">{{ locataire.statut|capitalize }}</span>
							{% endif %}
						</td>
						<td class="align-middle text-center">{{ locataire.dateEntree|date('d/m/Y') }}</td>
						<td class="align-middle text-end pe-3">
							<div class="btn-group btn-group-sm">
								<a href="{{ path('app_locataire_show', {'id': locataire.id}) }}" class="btn btn-light"
									title="Détails">
									<span class="fas fa-eye"></span>
								</a>
								<a href="{{ path('app_locataire_edit', {'id': locataire.id}) }}" class="btn btn-light"
									title="Modifier">
									<span class="fas fa-edit"></span>
								</a>
							</div>
						</td>
					</tr>
					{% else %}
					<tr>
						<td colspan="7" class="text-center py-5">
							<span class="fas fa-search-minus fa-3x text-200 mb-3"></span>
							<p class="text-600 fs-4 fw-semi-bold">Aucun locataire trouvé.</p>
							<p class="text-500 fs-11">Essayez de modifier vos critères de recherche.</p>
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>

	<!-- Pagination -->
	<div
		class="card-footer d-flex flex-column flex-sm-row align-items-center justify-content-between py-2 border-top g-3">
		<span class="fs-11 text-600 mb-2 mb-sm-0 text-center text-sm-start">Affiche
			{{ pagination|length }}
			sur
			{{ pagination.getTotalItemCount }}
			résultats</span>
		<div class="pagination-container">
			{{ knp_pagination_render(pagination) }}
		</div>
	</div>
</div>
{% endblock %}