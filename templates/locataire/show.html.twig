{% extends 'base.html.twig' %}

{% block title %}Détails du Locataire - {{ locataire.nomComplet }}
{% endblock %}

{% block body %}
	<!-- En-tête page -->
	<div class="card mb-3">
		<div class="card-header border-bottom">
			<div class="row flex-between-end">
				<div class="col-auto align-self-center">
					<h5 class="mb-0">Fiche Locataire</h5>
					<p class="mb-0 fs-11 text-muted">Consultation complète du dossier locataire</p>
				</div>
				<div class="col-auto ms-auto d-flex gap-2">
					<a href="{{ path('app_locataire_index') }}" class="btn btn-outline-secondary btn-sm">
						<span class="fas fa-arrow-left me-1"></span>Retour
					</a>
					<a href="{{ path('app_locataire_edit', {'id': locataire.id}) }}" class="btn btn-primary btn-sm">
						<span class="fas fa-edit me-1"></span>Modifier
					</a>
				</div>
			</div>
		</div>
	</div>

	<div class="row g-3">
		<!-- Colonne Gauche : Identité et Documents -->
		<div class="col-lg-8">
			<div class="card mb-3">
				<div class="card-body">
					<div class="row align-items-center">
						<div class="col-auto">
							<div class="avatar avatar-5xl">
								{% if locataire.photo %}
									<img src="{{ asset('uploads/locataires/' ~ locataire.photo) }}" alt="" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover;">
								{% else %}
									<div class="bg-subtle-primary text-primary d-flex align-items-center justify-content-center rounded-circle" style="width: 100px; height: 100px;">
										<span class="fas fa-user fa-3x"></span>
									</div>
								{% endif %}
							</div>
						</div>
						<div class="col">
							<h3 class="mb-1">{{ locataire.nomComplet }}</h3>
							<p class="text-600 mb-1">
								<span class="fas fa-briefcase me-2"></span>{{ locataire.profession }} chez <strong>{{ locataire.employeur }}</strong>
							</p>
							<div class="badge rounded-pill {% if locataire.statut == 'actif' %}bg-subtle-success text-success{% else %}bg-subtle-warning text-warning{% endif %}">
								{{ locataire.statut|capitalize }}
							</div>
						</div>
					</div>

					<div class="row mt-4 pt-4 border-top g-3">
						<div class="col-md-4">
							<div class="fs-11 text-muted text-uppercase fw-semi-bold">Nationalité</div>
							<div class="fw-bold">{{ locataire.nationalite }}</div>
						</div>
						<div class="col-md-4">
							<div class="fs-11 text-muted text-uppercase fw-semi-bold">Né(e) le</div>
							<div class="fw-bold">{{ locataire.dateNaissance|date('d/m/Y') }}</div>
						</div>
						<div class="col-md-4">
							<div class="fs-11 text-muted text-uppercase fw-semi-bold">À</div>
							<div class="fw-bold">{{ locataire.lieuNaissance }}</div>
						</div>
					</div>
				</div>
			</div>

			<div class="card mb-3">
                <div class="card-header border-bottom">
                    <h6 class="mb-0">Coordonnées</h6>
                </div>
				<div class="card-body">
					<div class="row g-3">
						<div class="col-md-6">
                            <label class="fs-11 text-muted text-uppercase fw-semi-bold d-block mb-0">Téléphone</label>
                            <a href="tel:{{ locataire.telephone }}" class="fs-4 fw-bold text-primary">{{ locataire.telephone }}</a>
						</div>
						<div class="col-md-6">
                            <label class="fs-11 text-muted text-uppercase fw-semi-bold d-block mb-0">Email</label>
                            <a href="mailto:{{ locataire.email }}" class="fs-4 fw-bold text-primary">{{ locataire.email }}</a>
						</div>
						<div class="col-12 mt-3 pt-3 border-top">
                            <label class="fs-11 text-muted text-uppercase fw-semi-bold d-block mb-1">Adresse Actuelle</label>
                            <p class="mb-0 text-700">{{ locataire.adresseActuelle }}</p>
						</div>
					</div>
				</div>
			</div>

			<div class="card mb-3">
				<div class="card-header border-bottom">
					<h6 class="mb-0">Documents d'Identité (CIN)</h6>
				</div>
				<div class="card-body">
					<div class="row g-3">
						<div class="col-md-6">
							<label class="fs-11 text-muted text-uppercase fw-semi-bold d-block mb-2">Recto</label>
							{% if locataire.cinRecto %}
                                <div class="border rounded p-2 bg-light text-center">
                                    <span class="fas fa-file-pdf fa-2x text-danger mb-2"></span>
                                    <div class="fs-11 text-truncate">{{ locataire.cinRecto }}</div>
                                    <a href="{{ asset('uploads/locataires/' ~ locataire.cinRecto) }}" target="_blank" class="btn btn-link btn-sm p-0">Ouvrir le document</a>
                                </div>
                            {% else %}
                                <div class="alert alert-warning mb-0 fs-11">Document manquant</div>
                            {% endif %}
						</div>
						<div class="col-md-6">
							<label class="fs-11 text-muted text-uppercase fw-semi-bold d-block mb-2">Verso</label>
							{% if locataire.cinVerso %}
                                <div class="border rounded p-2 bg-light text-center">
                                    <span class="fas fa-file-pdf fa-2x text-danger mb-2"></span>
                                    <div class="fs-11 text-truncate">{{ locataire.cinVerso }}</div>
                                    <a href="{{ asset('uploads/locataires/' ~ locataire.cinVerso) }}" target="_blank" class="btn btn-link btn-sm p-0">Ouvrir le document</a>
                                </div>
                            {% else %}
                                <div class="alert alert-warning mb-0 fs-11">Document manquant</div>
                            {% endif %}
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Colonne Droite : Location -->
		<div class="col-lg-4">
			<div class="card mb-3">
				<div class="card-header border-bottom">
					<h6 class="mb-0">Bien Loué</h6>
				</div>
				<div class="card-body">
					{% if locataire.bien %}
						<div class="d-flex align-items-center mb-3">
							<div class="avatar avatar-3xl me-3">
								{% if locataire.bien.image %}
									<img src="{{ asset('uploads/biens/' ~ locataire.bien.image) }}" alt="" class="rounded" style="width: 60px; height: 60px; object-fit: cover;">
								{% else %}
									<div class="bg-subtle-primary text-primary d-flex align-items-center justify-content-center rounded" style="width: 60px; height: 60px;">
										<span class="fas fa-home"></span>
									</div>
								{% endif %}
							</div>
							<div>
								<h6 class="mb-0">{{ locataire.bien.designation }}</h6>
								<p class="fs-11 text-muted mb-0">{{ locataire.bien.ville }}</p>
							</div>
						</div>
						<div class="border-top pt-3">
							<div class="d-flex justify-content-between mb-2">
								<span class="text-700 fs-11">Date d'entrée :</span>
								<span class="fw-bold">{{ locataire.dateEntree|date('d/m/Y') }}</span>
							</div>
                            <div class="d-flex justify-content-between mb-2">
								<span class="text-700 fs-11">Loyer mensuel :</span>
								<span class="fw-bold text-primary">{{ locataire.bien.prix ? locataire.bien.prix|number_format(0, ',', ' ') ~ ' Ar' : 'N/A' }}</span>
							</div>
							<a href="{{ path('app_biens_show', {'id': locataire.bien.id}) }}" class="btn btn-link btn-sm p-0">Gérer le bien
								<span class="fas fa-chevron-right ms-1 fs-11"></span>
							</a>
						</div>
					{% else %}
						<div class="text-center py-4">
							<span class="fas fa-key fa-3x text-200 mb-2"></span>
							<p class="text-muted fs-11 mb-0">Aucun bien associé à ce locataire.</p>
							<a href="{{ path('app_locataire_edit', {'id': locataire.id}) }}" class="btn btn-link btn-sm mt-2">Assigner un bien</a>
						</div>
					{% endif %}
				</div>
			</div>

			<div class="card border-0 bg-subtle-danger">
				<div class="card-body text-center">
					<p class="fs-11 text-danger mb-3">Attention : la suppression supprimera également tous les documents associés.</p>
					{{ include('locataire/_delete_form.html.twig') }}
				</div>
			</div>
		</div>
	</div>
{% endblock %}
